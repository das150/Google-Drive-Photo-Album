<title>Upload Photos to the Album</title>
<meta name="google-site-verification" content="..."/>
<meta name="viewport" content="..."/>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js"></script>
<link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/themes/smoothness/jquery-ui.css">
<body>
<style>
input[type="file"] {
    color: #808080;
    padding: 5px !important;
    -webkit-appearance: none !important;
}
::-webkit-file-upload-button {
  color: white;
  font-size: 20px !important;
  background-color: #3D9553;
  text-transform: uppercase;
  border: 0;
  border-radius: 8px;
  font-size: 11px;
  margin-top: -3.5px;
  font-weight: 950 !important;
  margin-right: 15px;
  line-height: 32px;
  height: 31px;
  font-weight: normal;
  text-align: center;
  vertical-align: middle;
  cursor: pointer;
  white-space: nowrap;
  padding: 0px 30px 10px; 20px;
  transition: 0.4s;
  -webkit-appearance: none !important;
}
::-webkit-file-upload-button:hover {
  border-radius: 10px !important;
  transition: 0.4s; opacity: 0.6;
  background-color: #3D9553 !important;
}
::-ms-browse {
  color: black;
  background-color: #2196f3;
  font-family: 'Lato', sans-serif;
  text-transform: uppercase;
  border: 0;
  border-radius: 2px;
  font-size: 12px;
  line-height: 32px;
  height: 32px;
  font-weight: normal;
  text-align: center;
  vertical-align: middle;
  cursor: pointer;
  white-space: nowrap;
  padding: 0 12px;
}
#shareButton {
  font-weight: 950;
  font-size: 20px;
  color: #3D9553; 
  border: none;
  cursor: pointer;
  margin-left: 5px;
  transition: 0.4s;
  background-color: #d6d6d6; 
  border-radius: 10px !important; 
  margin-top: 10px;
  padding: 10px; 
  -webkit-appearance: none !important;
}
#shareButton:hover {
  color: black !important; 
  transition: 0.4s; 
  box-shadow: 0px 0px 10px #888888;
}
#eventTitle {
    margin-left: 5px;
    margin-top: 50px;
    font-size: 50px;
    font-weight: 950 !important;
    font-family: arial !important;
}
#directions {
   color: #949494;
    margin-left: 5px;
    margin-top: 5px;
    font-family: arial; 
}
#uploadForm {
    margin-top: 50px;
}
#progressLabel {
    margin-top: 60px;
    margin-left: 5px;
}
#progressBar {
    margin-top: 8px;
    margin-left: 5px;
    height: 15px;
    width: 350px;
    border: none;
    border-radius: 110px;
}
</style>
    
<div id="formcontainer" width="100%">
  <div id="eventTitle"></div>
  <div id="directions">On desktop, hold down ctrl to select multiple files</div>

  <form id="uploadForm" target="_top"> 
    <input type="file" name="filename" id="fileUpload" multiple><br>
    <input type="button" value="Upload âžœ" id="shareButton" onclick="iteratorFileUpload();"><br>
  </form>
  
  <div id="output"></div>
  <b><div id="progressLabel"></div></b>
  <div id="progressBar"></div>
</div>

<p id="inputtedEvent" style="display: none;"></p><p id="inputtedMonth" style="display: none;"></p><p id="inputtedYear" style="display: none;"></p>

<script>
var uploadCount = {};
uploadCount.done = 0;
uploadCount.total = 0;

function iteratorFileUpload() {
    var allFiles = document.getElementById('fileUpload').files;

    if (allFiles.length == 0) {
        alert('Please select some files!');
    } else {
        uploadCount.total = allFiles.length;
        $('#progressBar').progressBar({
            value : false
        });
        $(".progressLabel").html('Preparing to upload.');
        for(var i = 0; i < allFiles.length; i++){
            sendFileToDrive(allFiles[i]);
        }
    }
}

function sendFileToDrive(file) {
    var reader = new FileReader();
    reader.onload = function (e) {
        var content = reader.result;
        console.log('Sending ' + file.name);
        var event = document.getElementById("inputtedEvent").textContent;
        var month = document.getElementById("inputtedMonth").textContent;
        var year = document.getElementById("inputtedYear").textContent;
        google.script.run.withSuccessHandler(updateProgressbar).uploadFileToDrive(content, file.name, event, year, month);
    }
    reader.readAsDataURL(file);
}

function updateProgressbar(uploadedID){
   console.log('Received: ' + uploadedID);
   uploadCount.done++;
   var calculatedProgress = Math.ceil((uploadCount.done / uploadCount.total)*100);
   $("#progressBar").progressBar({value: calculatedProgres});
   $("#progressLabel").text(uploadCount.done +'/'+ uploadCount.total);
   if(uploadCount.done == uploadCount.total){
       $(".progressLabel").text('Uploading Complete!');
       window.top.close();
   };
}
</script>
<script>
function fileUploaded(status) {
  document.getElementById('progressBar').style.display = 'none';
  document.getElementById('output').innerHTML = status;
}
</script>
<script>
google.script.url.getLocation(function(location) {
  var hash= (location.hash);
  var yearHash = hash.split("y34ieng", 1);
  var monthHash = hash.replace(yearHash + "y34ieng", "");
  var inputtedMonth = monthHash.split("mgjtjy34", 1);
  var nameHash = hash.replace(yearHash + "y34ieng" + inputtedMonth + "mgjtjy34", "");
  document.getElementById("eventTitle").innerHTML = nameHash;
  document.getElementById("inputtedYear").innerHTML = yearHash;
  document.getElementById("inputtedMonth").innerHTML = inputtedMonth;
  document.getElementById("inputtedEvent").innerHTML = nameHash;
});
</script>
</body>
